<!DOCTYPE html>
<html lang="ne">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Social Messenger</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { box-sizing: border-box; font-family: Arial, sans-serif; }
    body { margin:0; padding:0; background:#f0f2f5; }
    .container { display:flex; flex-direction:column; min-height:100vh; max-width:600px; margin:0 auto; background:#fff; position: relative; }

    /* Login Page Header */
    .login-header { 
      background:#1877f2; 
      padding:15px; 
      text-align:center; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .login-logo { 
      font-size:24px; 
      font-weight:bold; 
      color:#fff; 
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    }

    /* Main Login Content */
    .main-content { 
      display:flex; 
      flex:1; 
      align-items:center; 
      justify-content:center; 
      padding:20px; 
      background: url('https://www.transparenttextures.com/patterns/45-degree-fabric-light.png') #f0f2f5;
    }
    .login-container { 
      background:#fff; 
      border-radius:8px; 
      box-shadow:0 2px 4px rgba(0,0,0,.1); 
      padding:20px; 
      width:100%; 
      max-width:400px; 
      text-align:center; 
    }
    .login-container h1 { 
      font-size:18px; 
      margin-bottom:20px; 
      color:#1c1e21; 
    }
    .input-field { 
      margin-bottom:15px; 
      text-align:center; 
    }
    .input-field input { 
      width:100%; 
      padding:12px; 
      border:1px solid #dddfe2; 
      border-radius:6px; 
      font-size:16px; 
      text-align:center;
    }
    .login-btn { 
      background:#1877f2; 
      color:#fff; 
      border:none; 
      border-radius:6px; 
      padding:12px; 
      width:100%; 
      font-size:18px; 
      font-weight:bold; 
      cursor:pointer; 
      margin-bottom:15px; 
    }
    .create-account-btn { 
      background:#42b72a; 
      color:#fff; 
      border:none; 
      border-radius:6px; 
      padding:12px; 
      width:100%; 
      font-size:16px; 
      cursor:pointer; 
    }
    .forgot-password { 
      color:#1877f2; 
      text-decoration:none; 
      display:block; 
      margin-bottom:10px; 
      text-align:center;
    }
    .divider {
      height:1px;
      background:#dadde1;
      margin:20px 0;
    }

    /* App Container */
    .app-container { display:none; flex-direction:column; width:100%; height:100vh; }

    /* Header styles */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      background: #1877f2;
      color: white;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .logo {
      font-weight: bold;
      font-size: 18px;
    }
    
    .header-icons {
      display: flex;
      gap: 15px;
      align-items: center;
    }
    
    .header-icon {
      color: white;
      font-size: 18px;
      cursor: pointer;
    }
    
    .search-container {
      position: relative;
    }
    
    .search-bar { 
      display:flex; 
      align-items:center; 
      background:rgba(255,255,255,0.2); 
      border-radius:50px; 
      padding:5px 10px; 
      width: 180px;
    }
    
    .search-bar input { 
      border:none; 
      background:none; 
      outline:none; 
      width:100%; 
      padding:5px; 
      color: white;
      font-size: 14px;
    }
    
    .search-bar input::placeholder {
      color: rgba(255,255,255,0.7);
    }
    
    .profile-dropdown { position:relative; display:inline-block; }
    .profile-btn { background:#e4e6eb; border:none; border-radius:50%; width:40px; height:40px; display:flex; align-items:center; justify-content:center; cursor:pointer; }

    .dropdown-content { display:none; position:absolute; right:0; bottom:100%; background:#fff; min-width:220px; box-shadow:0 8px 16px rgba(0,0,0,.1); border-radius:6px; z-index:2; margin-bottom:10px; }
    .dropdown-content a, .dropdown-content button { color:#1c1e21; padding:12px 16px; text-decoration:none; display:block; font-size:14px; background:none; border:none; width:100%; text-align:left; cursor:pointer; border-bottom:1px solid #eee; }
    .dropdown-content a:hover, .dropdown-content button:hover { background:#f0f2f5; }
    .dropdown-content button:last-child { border-bottom:none; }

    .content { display:flex; flex-direction:column; flex:1; overflow:hidden; position: relative; }
    .page { display:none; flex-direction:column; flex:1; overflow-y:auto; }
    .page.active { display:flex; }

    .card { background:#fff; border-radius:8px; padding:15px; box-shadow:0 1px 2px rgba(0,0,0,.08); margin-bottom:15px; }
    .users-list h2, .friend-requests h2 { margin:0 0 12px 0; color:#1c1e21; font-size:16px; }

    .user-item { display:flex; align-items:center; gap:10px; padding:10px 0; border-bottom:1px solid #eee; cursor:default; }
    .user-avatar { width:40px; height:40px; border-radius:50%; background:#e4e6eb; display:flex; align-items:center; justify-content:center; color:#1877f2; position: relative; }
    .user-info { flex:1; }
    .user-name { font-weight:bold; font-size:15px; }
    .user-status { font-size:12px; color:#65676b; }
    .last-message { font-size: 13px; color: #65676b; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .clickable { cursor: pointer; }

    .add-friend-btn, .cancel-request-btn, .make-admin-btn, .block-btn, .unblock-btn { background:#1877f2; color:#fff; border:none; border-radius:6px; padding:6px 12px; font-size:12px; cursor:pointer; }
    .cancel-request-btn { background:#ffb400; }
    .make-admin-btn { background:#6f42c1; }
    .block-btn { background:#ff3b30; }
    .unblock-btn { background:#28a745; }

    .friend-requests .request-item { display:flex; align-items:center; padding:8px 0; border-bottom:1px solid #eee; }
    .request-actions { margin-left:auto; display:flex; gap:6px; }
    .accept-btn { background:#42b72a; color:#fff; border:none; border-radius:6px; padding:6px 12px; cursor:pointer; }
    .decline-btn { background:#e4e6eb; color:#1c1e21; border:none; border-radius:6px; padding:6px 12px; cursor:pointer; }

    .chat-container { display:flex; flex-direction:column; flex:1; height: 100vh; }
    .chat-header { display:flex; align-items:center; padding:10px 15px; background:#1877f2; color:#fff; position: sticky; top: 0; z-index: 1; }
    .chat-header-info { flex:1; display:flex; align-items:center; gap:10px; }
    .chat-header-avatar { width:40px; height:40px; border-radius:50%; background:#fff; display:flex; align-items:center; justify-content:center; color:#1877f2; position: relative; }
    .chat-header-name { font-weight:bold; }
    .chat-header-actions { display:flex; gap:15px; }
    .chat-header-action { color:#fff; font-size:18px; cursor: pointer; }

    .chat-messages { flex:1; padding:15px; overflow-y:auto; display:flex; flex-direction:column; gap:10px; background:#e5ddd5; }
    .message { max-width:80%; padding:10px 15px; border-radius:18px; position:relative; }
    .received { background:#fff; align-self:flex-start; border-bottom-left-radius:5px; }
    .sent { background:#dcf8c6; align-self:flex-end; border-bottom-right-radius:5px; }
    .message-time { font-size:11px; color:#65676b; margin-top:5px; text-align:right; }
    .message-image { max-width: 100%; border-radius: 8px; margin-top: 5px; }

    .message-input-container { display:flex; padding:10px; background:#f0f2f5; align-items:center; position: sticky; bottom: 0; }
    .message-input { flex:1; display:flex; background:#fff; border-radius:20px; padding:5px 15px; align-items:center; }
    .message-input input { flex:1; border:none; outline:none; padding:8px; background:none; }
    .message-input-action { color:#65676b; font-size:20px; margin:0 5px; cursor:pointer; }
    .send-btn { background:#1877f2; color:#fff; border:none; border-radius:50%; width:40px; height:40px; display:flex; align-items:center; justify-content:center; cursor:pointer; }

    /* Bottom navigation bar */
    .bottom-nav { 
      display: flex;
      background: #fff;
      border-top: 1px solid #eee;
      padding: 8px 0;
      position: sticky;
      bottom: 0;
    }
    
    .nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: #65676b;
      font-size: 12px;
      padding: 5px 0;
    }
    
    .nav-item.active {
      color: #1877f2;
    }
    
    .nav-icon {
      font-size: 22px;
      margin-bottom: 3px;
    }

    /* Badges */
    .badge { 
      background:#ff3b30; 
      color:#fff; 
      font-size:10px; 
      padding:2px 5px; 
      border-radius:10px; 
      position:absolute; 
      top:-5px; 
      right:-5px;
    }
    
    .online-badge {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 10px;
      height: 10px;
      background: #31a24c;
      border: 2px solid white;
      border-radius: 50%;
    }

    /* Loading spinner */
    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border-left-color: #1877f2;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .you-badge { 
      font-size:10px; 
      color:#fff; 
      background:#6c757d; 
      padding:2px 6px; 
      border-radius:8px; 
      margin-left:5px;
    }

    /* Profile page */
    .profile-page { padding:15px; }
    .profile-header { text-align:center; margin-bottom:20px; }
    .profile-avatar { width:100px; height:100px; border-radius:50%; background:#e4e6eb; margin:0 auto 10px; display:flex; align-items:center; justify-content:center; font-size:40px; color:#1877f2; position: relative; }
    .profile-name { font-size:20px; font-weight:bold; margin-bottom:5px; }
    .profile-email { color:#65676b; font-size:14px; }
    .profile-menu { list-style:none; padding:0; margin:0; }
    .profile-menu li { padding:12px 0; border-bottom:1px solid #eee; }
    .profile-menu li:last-child { border-bottom:none; }
    .profile-menu a { text-decoration:none; color:#1c1e21; display:block; }

    /* Admin panel */
    .admin-panel { display:none; padding:15px; }
    .admin-panel h2 { margin-top:0; }
    .admin-btn { background:#1877f2; color:#fff; border:none; border-radius:6px; padding:10px 15px; margin-right:10px; margin-bottom:10px; cursor:pointer; }

    /* Scrollable containers */
    .scrollable-container {
      overflow-y: auto;
      flex: 1;
      padding-bottom: 60px;
    }

    /* Search results */
    .search-results {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      z-index: 10;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      max-height: 300px;
      overflow-y: auto;
      display: none;
      width: 250px;
      border-radius: 8px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 100;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
    }
    
    .modal-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
    }
    
    .modal-input {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    .modal-btn {
      padding: 8px 15px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
    }
    
    .modal-btn-primary {
      background: #1877f2;
      color: white;
    }
    
    .modal-btn-secondary {
      background: #e4e6eb;
      color: #1c1e21;
    }

    /* Exam styles */
    .exam-container {
      padding: 15px;
    }
    
    .exam-form {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 1px 2px rgba(0,0,0,.08);
    }
    
    .exam-form h2 {
      margin-top: 0;
      text-align: center;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    .form-group input, .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    .form-group .photo-upload {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .form-group .photo-preview {
      width: 50px;
      height: 50px;
      border-radius: 4px;
      border: 1px dashed #ccc;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    
    .form-group .photo-preview img {
      max-width: 100%;
      max-height: 100%;
    }
    
    .exam-start-btn {
      background: #1877f2;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 12px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
    }
    
    .question-container {
      padding: 15px;
      background: white;
      border-radius: 8px;
      margin-bottom: 15px;
      box-shadow: 0 1px 2px rgba(0,0,0,.08);
    }
    
    .question-text {
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .option {
      display: block;
      margin-bottom: 8px;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .option.selected {
      background: #e7f3ff;
      border-color: #1877f2;
    }
    
    .timer {
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      margin: 10px 0;
      color: #1877f2;
    }
    
    .submit-exam-btn {
      background: #42b72a;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 12px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
      margin-top: 15px;
    }
    
    .result-container {
      padding: 15px;
      background: white;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    
    .result-header {
      text-align: center;
      margin-bottom: 15px;
    }
    
    .result-header h2 {
      margin: 0;
    }
    
    .student-photo {
      width: 100px;
      height: 100px;
      border-radius: 4px;
      margin: 10px auto;
      display: block;
      object-fit: cover;
    }
    
    .result-details {
      margin-bottom: 15px;
    }
    
    .result-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
    }
    
    .result-table th, .result-table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    
    .result-table th {
      background: #f0f2f5;
    }
    
    .print-btn {
      background: #1877f2;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 10px 15px;
      cursor: pointer;
      display: block;
      margin: 0 auto;
    }
    
    /* Notice styles */
    .notice-container {
      padding: 15px;
    }
    
    .notice-item {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 1px 2px rgba(0,0,0,.08);
    }
    
    .notice-title {
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .notice-message {
      margin-bottom: 10px;
    }
    
    .notice-image {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 10px;
    }
    
    .notice-date {
      color: #65676b;
      font-size: 12px;
      text-align: right;
    }
    
    /* Book styles */
    .book-container {
      padding: 15px;
    }
    
    .book-item {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 1px 2px rgba(0,0,0,.08);
      cursor: pointer;
    }
    
    .book-title {
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .book-desc {
      color: #65676b;
      font-size: 14px;
    }
    
    /* Admin exam management */
    .exam-management {
      padding: 15px;
    }
    
    .exam-tabs {
      display: flex;
      border-bottom: 1px solid #ddd;
      margin-bottom: 15px;
    }
    
    .exam-tab {
      padding: 10px 15px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
    }
    
    .exam-tab.active {
      border-bottom: 2px solid #1877f2;
      font-weight: bold;
    }
    
    .exam-content {
      display: none;
    }
    
    .exam-content.active {
      display: block;
    }
    
    .course-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .course-item {
      background: #f0f2f5;
      border-radius: 6px;
      padding: 10px 15px;
      cursor: pointer;
    }
    
    .course-item.active {
      background: #1877f2;
      color: white;
    }
    
    .subject-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .subject-item {
      background: #f0f2f5;
      border-radius: 6px;
      padding: 10px 15px;
      cursor: pointer;
    }
    
    .subject-item.active {
      background: #1877f2;
      color: white;
    }
    
    .question-form {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 1px 2px rgba(0,0,0,.08);
      margin-bottom: 15px;
    }
    
    .question-list {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 1px 2px rgba(0,0,0,.08);
    }
    
    .question-list-item {
      padding: 10px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
    }
    
    .question-list-item:last-child {
      border-bottom: none;
    }
    
    .question-list-item:hover {
      background: #f0f2f5;
    }
    
    /* Responsive adjustments */
    @media (max-width: 480px) {
      .container { max-width:100%; }
      .chat-header { padding:10px; }
      .chat-header-actions { gap:10px; }
      .search-bar { width: 150px; }
    }
    
    @media print {
      body * {
        visibility: hidden;
      }
      .result-container, .result-container * {
        visibility: visible;
      }
      .result-container {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
      .print-btn {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Login Page -->
    <div class="login-page" id="login-page" style="display:flex; flex-direction:column;">
      <header class="login-header">
        <div class="login-logo">IMS Darpan</div>
      </header>

      <div class="main-content">
        <div class="login-container">
          <h1>Log in to your account</h1>
          <div class="input-field">
            <input type="text" id="login-email" placeholder="Email address">
          </div>
          <div class="input-field">
            <input type="password" id="login-password" placeholder="Password">
          </div>
          <button class="login-btn" id="login-button">Log In</button>
          <a href="#" class="forgot-password" id="forgot-password">Forgot password?</a>
          <div class="divider"></div>
          <button class="create-account-btn" id="create-account-btn">Create new account</button>
        </div>
      </div>
    </div>

    <!-- App Container -->
    <div class="app-container" id="app-container">
      <!-- Home Page -->
      <div class="page active" id="home-page">
        <header>
          <button class="header-icon" id="back-btn-home" style="display: none;"><i class="fas fa-arrow-left"></i></button>
          <div class="logo">IMS Darpan</div>
          <div class="header-icons">
            <div class="search-container">
              <div class="search-bar">
                <i class="fas fa-search" style="color: white; font-size: 14px;"></i>
                <input type="text" id="search-input" placeholder="Search...">
              </div>
              <div class="search-results" id="search-results"></div>
            </div>
            <div style="position:relative;">
              <i class="fas fa-bell header-icon" id="notice-btn"></i>
              <span id="notice-count" class="badge" style="display:none;">0</span>
            </div>
          </div>
        </header>

        <div class="content">
          <div class="scrollable-container">
            <div class="card users-list">
              <h2>Courses</h2>
              <div id="courses-list-container">
                <div class="user-item clickable" id="basic-course-btn">
                  <div class="user-avatar"><i class="fas fa-book"></i></div>
                  <div class="user-info">
                    <div class="user-name">Basic Course</div>
                    <div class="last-message">Word, Excel, PowerPoint</div>
                  </div>
                </div>
                <div class="user-item clickable" id="diploma-course-btn">
                  <div class="user-avatar"><i class="fas fa-graduation-cap"></i></div>
                  <div class="user-info">
                    <div class="user-name">Diploma Course</div>
                    <div class="last-message">Pagemaker, Photoshop, HTML</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Exam Start Page -->
      <div class="page" id="exam-start-page">
        <header>
          <button class="header-icon" id="back-btn-exam-start"><i class="fas fa-arrow-left"></i></button>
          <div class="logo">Exam Registration</div>
          <div class="header-icons"></div>
        </header>

        <div class="content">
          <div class="scrollable-container">
            <div class="exam-container">
              <div class="exam-form">
                <h2>Exam Registration</h2>
                <div class="form-group">
                  <label for="student-name">Student Name</label>
                  <input type="text" id="student-name" placeholder="Enter your name">
                </div>
                <div class="form-group">
                  <label for="father-name">Father's Name</label>
                  <input type="text" id="father-name" placeholder="Enter father's name">
                </div>
                <div class="form-group">
                  <label for="dob">Date of Birth</label>
                  <input type="date" id="dob">
                </div>
                <div class="form-group">
                  <label for="symbol-no">Symbol No.</label>
                  <input type="text" id="symbol-no" placeholder="Enter symbol number">
                </div>
                <div class="form-group">
                  <label>Course</label>
                  <input type="text" id="exam-course" readonly>
                </div>
                <div class="form-group">
                  <label for="exam-subject">Subject</label>
                  <select id="exam-subject">
                    <option value="">Select subject</option>
                    <!-- Subjects will be populated by JavaScript -->
                  </select>
                </div>
                <div class="form-group">
                  <label>Photo</label>
                  <div class="photo-upload">
                    <div class="photo-preview" id="photo-preview">
                      <i class="fas fa-camera" style="color:#ccc;"></i>
                    </div>
                    <input type="file" id="photo-upload" accept="image/*" style="display:none;">
                    <button class="modal-btn modal-btn-secondary" onclick="document.getElementById('photo-upload').click()">Choose Photo</button>
                  </div>
                </div>
                <button class="exam-start-btn" id="start-exam-btn">Continue to Exam</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Exam Page -->
      <div class="page" id="exam-page">
        <header>
          <div class="logo">Exam</div>
          <div class="header-icons">
            <div class="timer" id="exam-timer">Time: 30:00</div>
          </div>
        </header>

        <div class="content">
          <div class="scrollable-container" id="exam-questions-container">
            <!-- Questions will be loaded here -->
          </div>
          
          <div style="padding:15px;">
            <button class="submit-exam-btn" id="submit-exam-btn">Submit Exam</button>
          </div>
        </div>
      </div>

      <!-- Exam Result Page -->
      <div class="page" id="exam-result-page">
        <header>
          <button class="header-icon" id="back-btn-result"><i class="fas fa-arrow-left"></i></button>
          <div class="logo">Exam Result</div>
          <div class="header-icons"></div>
        </header>

        <div class="content">
          <div class="scrollable-container">
            <div class="result-container">
              <div class="result-header">
                <h2>IMS Darpan Computer Business Solutions PVT.LTD</h2>
                <p>Kohalpur-11, Banke</p>
                <img src="" class="student-photo" id="result-photo">
              </div>
              
              <div class="result-details">
                <p><strong>Student Name:</strong> <span id="result-name"></span></p>
                <p><strong>Father's Name:</strong> <span id="result-father"></span></p>
                <p><strong>Date of Birth:</strong> <span id="result-dob"></span></p>
                <p><strong>Symbol No:</strong> <span id="result-symbol"></span></p>
                <p><strong>Course:</strong> <span id="result-course"></span></p>
                <p><strong>Subject:</strong> <span id="result-subject"></span></p>
              </div>
              
              <table class="result-table">
                <tr>
                  <th>Total Questions</th>
                  <td id="total-questions">0</td>
                </tr>
                <tr>
                  <th>Correct Answers</th>
                  <td id="correct-answers">0</td>
                </tr>
                <tr>
                  <th>Score</th>
                  <td id="exam-score">0</td>
                </tr>
                <tr>
                  <th>Percentage</th>
                  <td id="exam-percentage">0%</td>
                </tr>
                <tr>
                  <th>Remarks</th>
                  <td id="exam-remarks">-</td>
                </tr>
              </table>
              
              <button class="print-btn" id="print-result-btn">Print Result</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Notice Page -->
      <div class="page" id="notice-page">
        <header>
          <button class="header-icon" id="back-btn-notice"><i class="fas fa-arrow-left"></i></button>
          <div class="logo">Notices</div>
          <div class="header-icons"></div>
        </header>

        <div class="content">
          <div class="scrollable-container">
            <div class="notice-container" id="notices-container">
              <!-- Notices will be loaded here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Book Page -->
      <div class="page" id="book-page">
        <header>
          <button class="header-icon" id="back-btn-book"><i class="fas fa-arrow-left"></i></button>
          <div class="logo">Books</div>
          <div class="header-icons"></div>
        </header>

        <div class="content">
          <div class="scrollable-container">
            <div class="book-container" id="books-container">
              <!-- Books will be loaded here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Profile Page -->
      <div class="page" id="profile-page">
        <header>
          <button class="header-icon" id="back-btn-profile"><i class="fas fa-arrow-left"></i></button>
          <div class="logo">Profile</div>
          <div class="header-icons">
            <i class="fas fa-cog header-icon" id="settings-btn"></i>
          </div>
        </header>

        <div class="content">
          <div class="scrollable-container">
            <div class="profile-page">
              <div class="profile-header">
                <div class="profile-avatar" id="profile-avatar">
                  <i class="fas fa-user"></i>
                  <div id="profile-online-status" class="online-badge"></div>
                </div>
                <div class="profile-name" id="profile-name-display"></div>
                <div class="profile-email" id="profile-email-display"></div>
              </div>

              <ul class="profile-menu">
                <li><a href="#" id="edit-profile-btn"><i class="fas fa-user-edit" style="margin-right:10px;"></i> Edit Profile</a></li>
                <li><a href="#" id="results-btn"><i class="fas fa-poll" style="margin-right:10px;"></i> Exam Results</a></li>
                <li><a href="#" id="books-btn"><i class="fas fa-book" style="margin-right:10px;"></i> Books</a></li>
                <li><a href="#" id="logout-btn"><i class="fas fa-sign-out-alt" style="margin-right:10px;"></i> Log Out</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Results Page -->
      <div class="page" id="results-page">
        <header>
          <button class="header-icon" id="back-btn-results"><i class="fas fa-arrow-left"></i></button>
          <div class="logo">Exam Results</div>
          <div class="header-icons"></div>
        </header>

        <div class="content">
          <div class="scrollable-container">
            <div class="card users-list">
              <h2>Your Exam Results</h2>
              <div id="results-list-container">
                <!-- Results will be loaded here -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Admin Panel -->
      <div class="page admin-panel" id="admin-page">
        <header>
          <button class="header-icon" id="back-btn-admin"><i class="fas fa-arrow-left"></i></button>
          <div class="logo">Admin Panel</div>
          <div class="header-icons"></div>
        </header>

        <div class="content">
          <div class="scrollable-container">
            <div class="exam-tabs">
              <div class="exam-tab active" data-tab="manage-exam">Manage Exams</div>
              <div class="exam-tab" data-tab="manage-notice">Manage Notices</div>
              <div class="exam-tab" data-tab="manage-book">Manage Books</div>
              <div class="exam-tab" data-tab="view-results">View Results</div>
            </div>
            
            <div class="exam-content active" id="manage-exam">
              <div class="course-list" id="admin-course-list">
                <div class="course-item active" data-course="basic">Basic Course</div>
                <div class="course-item" data-course="diploma">Diploma Course</div>
              </div>
              
              <div class="subject-list" id="admin-subject-list">
                <div class="subject-item active" data-subject="word">Word</div>
                <div class="subject-item" data-subject="excel">Excel</div>
                <div class="subject-item" data-subject="powerpoint">PowerPoint</div>
                <div class="subject-item" data-subject="pagemaker">PageMaker</div>
                <div class="subject-item" data-subject="photoshop">Photoshop</div>
                <div class="subject-item" data-subject="html">HTML</div>
                <div class="subject-item" data-subject="access">Access</div>
                <div class="subject-item" data-subject="tally">Tally</div>
              </div>
              
              <div class="question-form">
                <h3>Add New Question</h3>
                <div class="form-group">
                  <label for="question-text">Question</label>
                  <input type="text" id="question-text" placeholder="Enter question">
                </div>
                <div class="form-group">
                  <label for="option1">Option 1</label>
                  <input type="text" id="option1" placeholder="Enter option 1">
                </div>
                <div class="form-group">
                  <label for="option2">Option 2</label>
                  <input type="text" id="option2" placeholder="Enter option 2">
                </div>
                <div class="form-group">
                  <label for="option3">Option 3</label>
                  <input type="text" id="option3" placeholder="Enter option 3">
                </div>
                <div class="form-group">
                  <label for="option4">Option 4</label>
                  <input type="text" id="option4" placeholder="Enter option 4">
                </div>
                <div class="form-group">
                  <label for="correct-option">Correct Option</label>
                  <select id="correct-option">
                    <option value="1">Option 1</option>
                    <option value="2">Option 2</option>
                    <option value="3">Option 3</option>
                    <option value="4">Option 4</option>
                  </select>
                </div>
                <button class="admin-btn" id="add-question-btn">Add Question</button>
              </div>
              
              <div class="question-list" id="admin-questions-list">
                <h3>Questions</h3>
                <!-- Questions will be listed here -->
              </div>
            </div>
            
            <div class="exam-content" id="manage-notice">
              <div class="question-form">
                <h3>Add New Notice</h3>
                <div class="form-group">
                  <label for="notice-title">Title</label>
                  <input type="text" id="notice-title" placeholder="Enter notice title">
                </div>
                <div class="form-group">
                  <label for="notice-message">Message</label>
                  <textarea id="notice-message" placeholder="Enter notice message" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:4px;"></textarea>
                </div>
                <div class="form-group">
                  <label>Image (Optional)</label>
                  <div class="photo-upload">
                    <div class="photo-preview" id="notice-photo-preview">
                      <i class="fas fa-image" style="color:#ccc;"></i>
                    </div>
                    <input type="file" id="notice-photo-upload" accept="image/*" style="display:none;">
                    <button class="modal-btn modal-btn-secondary" onclick="document.getElementById('notice-photo-upload').click()">Choose Image</button>
                  </div>
                </div>
                <button class="admin-btn" id="add-notice-btn">Add Notice</button>
              </div>
              
              <div class="question-list" id="admin-notices-list">
                <h3>Existing Notices</h3>
                <!-- Notices will be listed here -->
              </div>
            </div>
            
            <div class="exam-content" id="manage-book">
              <div class="question-form">
                <h3>Add New Book</h3>
                <div class="form-group">
                  <label for="book-title">Title</label>
                  <input type="text" id="book-title" placeholder="Enter book title">
                </div>
                <div class="form-group">
                  <label for="book-desc">Description</label>
                  <textarea id="book-desc" placeholder="Enter book description" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:4px;"></textarea>
                </div>
                <div class="form-group">
                  <label for="book-course">Course</label>
                  <select id="book-course">
                    <option value="basic">Basic</option>
                    <option value="diploma">Diploma</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>PDF File</label>
                  <input type="file" id="book-file-upload" accept=".pdf" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:4px;">
                </div>
                <button class="admin-btn" id="add-book-btn">Add Book</button>
              </div>
              
              <div class="question-list" id="admin-books-list">
                <h3>Existing Books</h3>
                <!-- Books will be listed here -->
              </div>
            </div>
            
            <div class="exam-content" id="view-results">
              <div class="question-list" id="admin-results-list">
                <h3>Student Results</h3>
                <!-- Results will be listed here -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom Navigation Bar -->
      <div class="bottom-nav" id="bottom-nav">
        <a href="#" class="nav-item active" id="home-nav">
          <i class="fas fa-home nav-icon"></i>
          <span>Home</span>
        </a>
        <a href="#" class="nav-item" id="exam-nav">
          <i class="fas fa-clipboard-list nav-icon"></i>
          <span>Exam</span>
        </a>
        <a href="#" class="nav-item" id="notice-nav">
          <i class="fas fa-bell nav-icon"></i>
          <span>Notices</span>
        </a>
        <a href="#" class="nav-item" id="book-nav">
          <i class="fas fa-book nav-icon"></i>
          <span>Books</span>
        </a>
        <a href="#" class="nav-item" id="profile-nav">
          <i class="fas fa-user nav-icon"></i>
          <span>Profile</span>
        </a>
      </div>
    </div>
    
    <!-- Edit Profile Modal -->
    <div class="modal" id="edit-profile-modal">
      <div class="modal-content">
        <div class="modal-title">Edit Profile</div>
        <input type="text" class="modal-input" id="edit-username" placeholder="Username">
        <input type="email" class="modal-input" id="edit-email" placeholder="Email">
        <div class="modal-actions">
          <button class="modal-btn modal-btn-secondary" id="cancel-edit-btn">Cancel</button>
          <button class="modal-btn modal-btn-primary" id="save-profile-btn">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDYwtq05q9qXhrNVJ4I-I-LuD1dpp2Suk8",
      authDomain: "massage-8c66f.firebaseapp.com",
      databaseURL: "https://massage-8c66f-default-rtdb.firebaseio.com",
      projectId: "massage-8c66f",
      storageBucket: "massage-8c66f.appspot.com",
      messagingSenderId: "557008720018",
      appId: "1:557008720018:web:22055db26bbfb2bab3d64b"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    // DOM Elements
    const loginPage = document.getElementById('login-page');
    const appContainer = document.getElementById('app-container');
    const loginButton = document.getElementById('login-button');
    const createAccountBtn = document.getElementById('create-account-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const noticeBtn = document.getElementById('notice-btn');
    const noticeCountBadge = document.getElementById('notice-count');
    const backBtn = document.getElementById('back-btn');
    const backBtnHome = document.getElementById('back-btn-home');
    const backBtnExamStart = document.getElementById('back-btn-exam-start');
    const backBtnResult = document.getElementById('back-btn-result');
    const backBtnNotice = document.getElementById('back-btn-notice');
    const backBtnBook = document.getElementById('back-btn-book');
    const backBtnProfile = document.getElementById('back-btn-profile');
    const backBtnResults = document.getElementById('back-btn-results');
    const backBtnAdmin = document.getElementById('back-btn-admin');
    const coursesListContainer = document.getElementById('courses-list-container');
    const examQuestionsContainer = document.getElementById('exam-questions-container');
    const examTimer = document.getElementById('exam-timer');
    const submitExamBtn = document.getElementById('submit-exam-btn');
    const startExamBtn = document.getElementById('start-exam-btn');
    const resultPhoto = document.getElementById('result-photo');
    const resultName = document.getElementById('result-name');
    const resultFather = document.getElementById('result-father');
    const resultDob = document.getElementById('result-dob');
    const resultSymbol = document.getElementById('result-symbol');
    const resultCourse = document.getElementById('result-course');
    const resultSubject = document.getElementById('result-subject');
    const totalQuestions = document.getElementById('total-questions');
    const correctAnswers = document.getElementById('correct-answers');
    const examScore = document.getElementById('exam-score');
    const examPercentage = document.getElementById('exam-percentage');
    const examRemarks = document.getElementById('exam-remarks');
    const printResultBtn = document.getElementById('print-result-btn');
    const noticesContainer = document.getElementById('notices-container');
    const booksContainer = document.getElementById('books-container');
    const resultsListContainer = document.getElementById('results-list-container');
    const profileNameDisplay = document.getElementById('profile-name-display');
    const profileEmailDisplay = document.getElementById('profile-email-display');
    const profileAvatar = document.getElementById('profile-avatar');
    const profileOnlineStatus = document.getElementById('profile-online-status');
    const basicCourseBtn = document.getElementById('basic-course-btn');
    const diplomaCourseBtn = document.getElementById('diploma-course-btn');
    const studentNameInput = document.getElementById('student-name');
    const fatherNameInput = document.getElementById('father-name');
    const dobInput = document.getElementById('dob');
    const symbolNoInput = document.getElementById('symbol-no');
    const examCourseInput = document.getElementById('exam-course');
    const examSubjectSelect = document.getElementById('exam-subject');
    const photoUpload = document.getElementById('photo-upload');
    const photoPreview = document.getElementById('photo-preview');
    const resultsBtn = document.getElementById('results-btn');
    const booksBtn = document.getElementById('books-btn');
    const editProfileModal = document.getElementById('edit-profile-modal');
    const editUsernameInput = document.getElementById('edit-username');
    const editEmailInput = document.getElementById('edit-email');
    const saveProfileBtn = document.getElementById('save-profile-btn');
    const cancelEditBtn = document.getElementById('cancel-edit-btn');

    // Admin elements
    const adminCourseList = document.getElementById('admin-course-list');
    const adminSubjectList = document.getElementById('admin-subject-list');
    const questionTextInput = document.getElementById('question-text');
    const option1Input = document.getElementById('option1');
    const option2Input = document.getElementById('option2');
    const option3Input = document.getElementById('option3');
    const option4Input = document.getElementById('option4');
    const correctOptionSelect = document.getElementById('correct-option');
    const addQuestionBtn = document.getElementById('add-question-btn');
    const adminQuestionsList = document.getElementById('admin-questions-list');
    const noticeTitleInput = document.getElementById('notice-title');
    const noticeMessageInput = document.getElementById('notice-message');
    const noticePhotoUpload = document.getElementById('notice-photo-upload');
    const noticePhotoPreview = document.getElementById('notice-photo-preview');
    const addNoticeBtn = document.getElementById('add-notice-btn');
    const adminNoticesList = document.getElementById('admin-notices-list');
    const bookTitleInput = document.getElementById('book-title');
    const bookDescInput = document.getElementById('book-desc');
    const bookCourseSelect = document.getElementById('book-course');
    const bookFileUpload = document.getElementById('book-file-upload');
    const addBookBtn = document.getElementById('add-book-btn');
    const adminBooksList = document.getElementById('admin-books-list');
    const adminResultsList = document.getElementById('admin-results-list');
    const examTabs = document.querySelectorAll('.exam-tab');
    const examContents = document.querySelectorAll('.exam-content');

    // Page elements
    const pages = {
      home: document.getElementById('home-page'),
      examStart: document.getElementById('exam-start-page'),
      exam: document.getElementById('exam-page'),
      examResult: document.getElementById('exam-result-page'),
      notice: document.getElementById('notice-page'),
      book: document.getElementById('book-page'),
      profile: document.getElementById('profile-page'),
      results: document.getElementById('results-page'),
      admin: document.getElementById('admin-page')
    };

    // Navigation elements
    const navItems = {
      home: document.getElementById('home-nav'),
      exam: document.getElementById('exam-nav'),
      notice: document.getElementById('notice-nav'),
      book: document.getElementById('book-nav'),
      profile: document.getElementById('profile-nav')
    };

    // State variables
    let currentUser = null;
    let currentUserData = null;
    let currentExam = null;
    let examTimeLeft = 1800; // 30 minutes in seconds
    let examTimerInterval = null;
    let selectedPhoto = null;
    let selectedNoticePhoto = null;
    let selectedBookFile = null;
    let currentAdminCourse = 'basic';
    let currentAdminSubject = 'word';

    // Subjects for each course
    const courseSubjects = {
      basic: ['Word', 'Excel', 'PowerPoint'],
      diploma: ['Pagemaker', 'Photoshop', 'HTML', 'Access', 'Tally']
    };

    // Initialize the application
    function init() {
      setupEventListeners();
      auth.onAuthStateChanged(handleAuthStateChange);
    }

    // Set up event listeners
    function setupEventListeners() {
      // Navigation
      navItems.home.addEventListener('click', (e) => {
        e.preventDefault();
        showPage('home');
      });
      
      navItems.exam.addEventListener('click', (e) => {
        e.preventDefault();
        showPage('examStart');
      });
      
      navItems.notice.addEventListener('click', (e) => {
        e.preventDefault();
        showPage('notice');
      });
      
      navItems.book.addEventListener('click', (e) => {
        e.preventDefault();
        showPage('book');
      });
      
      navItems.profile.addEventListener('click', (e) => {
        e.preventDefault();
        showPage('profile');
      });

      // Back buttons
      backBtnExamStart.addEventListener('click', () => showPage('home'));
      backBtnResult.addEventListener('click', () => showPage('home'));
      backBtnNotice.addEventListener('click', () => showPage('home'));
      backBtnBook.addEventListener('click', () => showPage('home'));
      backBtnProfile.addEventListener('click', () => showPage('home'));
      backBtnResults.addEventListener('click', () => showPage('profile'));
      backBtnAdmin.addEventListener('click', () => showPage('profile'));

      // Login
      loginButton.addEventListener('click', handleLogin);

      // Create account
      createAccountBtn.addEventListener('click', handleCreateAccount);

      // Logout
      logoutBtn.addEventListener('click', handleLogout);

      // Notice button
      noticeBtn.addEventListener('click', () => {
        showPage('notice');
      });

      // Course buttons
      basicCourseBtn.addEventListener('click', () => {
        currentExam = { course: 'Basic Course', courseKey: 'basic' };
        examCourseInput.value = 'Basic Course';
        populateSubjectSelect('basic');
        showPage('examStart');
      });
      
      diplomaCourseBtn.addEventListener('click', () => {
        currentExam = { course: 'Diploma Course', courseKey: 'diploma' };
        examCourseInput.value = 'Diploma Course';
        populateSubjectSelect('diploma');
        showPage('examStart');
      });

      // Photo upload
      photoUpload.addEventListener('change', (e) => {
        if (e.target.files[0]) {
          selectedPhoto = e.target.files[0];
          const reader = new FileReader();
          reader.onload = (event) => {
            photoPreview.innerHTML = `<img src="${event.target.result}" style="width:100%; height:100%; object-fit:cover;">`;
          };
          reader.readAsDataURL(selectedPhoto);
        }
      });

      // Start exam
      startExamBtn.addEventListener('click', startExam);

      // Submit exam
      submitExamBtn.addEventListener('click', submitExam);

      // Print result
      printResultBtn.addEventListener('click', () => {
        window.print();
      });

      // Results button
      resultsBtn.addEventListener('click', (e) => {
        e.preventDefault();
        showPage('results');
      });

      // Books button
      booksBtn.addEventListener('click', (e) => {
        e.preventDefault();
        showPage('book');
      });

      // Edit profile
      document.getElementById('edit-profile-btn').addEventListener('click', (e) => {
        e.preventDefault();
        showEditProfileModal();
      });

      saveProfileBtn.addEventListener('click', saveProfile);
      cancelEditBtn.addEventListener('click', () => {
        editProfileModal.style.display = 'none';
      });

      // Admin tabs
      examTabs.forEach(tab => {
        tab.addEventListener('click', () => {
          examTabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          
          examContents.forEach(content => content.classList.remove('active'));
          document.getElementById(tab.dataset.tab).classList.add('active');
        });
      });

      // Admin course selection
      adminCourseList.addEventListener('click', (e) => {
        if (e.target.classList.contains('course-item')) {
          adminCourseList.querySelectorAll('.course-item').forEach(item => {
            item.classList.remove('active');
          });
          e.target.classList.add('active');
          currentAdminCourse = e.target.dataset.course;
          loadQuestions();
        }
      });

      // Admin subject selection
      adminSubjectList.addEventListener('click', (e) => {
        if (e.target.classList.contains('subject-item')) {
          adminSubjectList.querySelectorAll('.subject-item').forEach(item => {
            item.classList.remove('active');
          });
          e.target.classList.add('active');
          currentAdminSubject = e.target.dataset.subject;
          loadQuestions();
        }
      });

      // Add question
      addQuestionBtn.addEventListener('click', addQuestion);

      // Notice photo upload
      noticePhotoUpload.addEventListener('change', (e) => {
        if (e.target.files[0]) {
          selectedNoticePhoto = e.target.files[0];
          const reader = new FileReader();
          reader.onload = (event) => {
            noticePhotoPreview.innerHTML = `<img src="${event.target.result}" style="width:100%; height:100%; object-fit:cover;">`;
          };
          reader.readAsDataURL(selectedNoticePhoto);
        }
      });

      // Add notice
      addNoticeBtn.addEventListener('click', addNotice);

      // Book file upload
      bookFileUpload.addEventListener('change', (e) => {
        if (e.target.files[0]) {
          selectedBookFile = e.target.files[0];
        }
      });

      // Add book
      addBookBtn.addEventListener('click', addBook);
    }

    // Populate subject select dropdown
    function populateSubjectSelect(courseKey) {
      examSubjectSelect.innerHTML = '<option value="">Select subject</option>';
      courseSubjects[courseKey].forEach(subject => {
        const option = document.createElement('option');
        option.value = subject.toLowerCase();
        option.textContent = subject;
        examSubjectSelect.appendChild(option);
      });
    }

    // Show edit profile modal
    function showEditProfileModal() {
      if (!currentUserData) return;
      
      editUsernameInput.value = currentUserData.username || '';
      editEmailInput.value = currentUserData.email || '';
      editProfileModal.style.display = 'flex';
    }

    // Save profile changes
    function saveProfile() {
      const newUsername = editUsernameInput.value.trim();
      const newEmail = editEmailInput.value.trim();
      
      if (!newUsername) {
        alert('Username is required');
        return;
      }
      
      showLoading();
      
      const updates = {
        username: newUsername,
        email: newEmail
      };
      
      db.ref(`users/${currentUser.uid}`).update(updates)
        .then(() => {
          editProfileModal.style.display = 'none';
          alert('Profile updated successfully');
        })
        .catch(error => {
          alert('Failed to update profile: ' + error.message);
        })
        .finally(() => {
          hideLoading();
        });
    }

    // Show specific page
    function showPage(pageName) {
      // Hide all pages
      Object.values(pages).forEach(page => {
        page.classList.remove('active');
      });
      
      // Show selected page
      pages[pageName].classList.add('active');
      
      // Update active nav item
      Object.values(navItems).forEach(item => {
        item.classList.remove('active');
      });
      
      if (pageName !== 'admin' && pageName !== 'examStart' && pageName !== 'exam' && 
          pageName !== 'examResult' && pageName !== 'results') {
        navItems[pageName].classList.add('active');
      }
      
      // Load data if needed
      if (pageName === 'notice') {
        loadNotices();
      } else if (pageName === 'book') {
        loadBooks();
      } else if (pageName === 'profile') {
        updateProfileDisplay();
      } else if (pageName === 'results') {
        loadUserResults();
      } else if (pageName === 'admin') {
        loadAdminData();
      }
    }

    // Handle authentication state changes
    function handleAuthStateChange(user) {
      if (user) {
        currentUser = user;
        initializeAppAfterLogin();
      } else {
        currentUser = null;
        currentUserData = null;
        loginPage.style.display = 'flex';
        appContainer.style.display = 'none';
      }
    }

    // Initialize app after successful login
    function initializeAppAfterLogin() {
      showLoading();
      
      // Ensure user record exists
      db.ref('users/' + currentUser.uid).once('value').then(snap => {
        if (!snap.exists()) {
          const username = currentUser.email ? currentUser.email.split('@')[0] : 'user';
          return saveUserToDB(currentUser.uid, {
            uid: currentUser.uid,
            username: username,
            email: currentUser.email,
            role: 'user',
            blocked: false
          });
        }
      }).catch(error => {
        console.error("Error checking user record:", error);
      }).finally(() => {
        // Attach listener for user data
        db.ref('users/' + currentUser.uid).on('value', snap => {
          currentUserData = snap.val();
          if (currentUserData) {
            updateProfileDisplay();
            
            // Show admin panel if user is admin
            if (currentUserData.role === 'admin') {
              document.getElementById('profile-menu').innerHTML += `
                <li><a href="#" id="admin-btn"><i class="fas fa-user-shield" style="margin-right:10px;"></i> Admin Panel</a></li>
              `;
              document.getElementById('admin-btn').addEventListener('click', (e) => {
                e.preventDefault();
                showPage('admin');
              });
            }
          }
          hideLoading();
        });

        // Show app UI
        loginPage.style.display = 'none';
        appContainer.style.display = 'flex';

        // Load initial data
        loadNotices();
        showPage('home');
      });
    }

    // Update profile display
    function updateProfileDisplay() {
      if (currentUserData) {
        profileNameDisplay.textContent = currentUserData.username || (currentUser.email ? currentUser.email.split('@')[0] : 'User');
        profileEmailDisplay.textContent = currentUserData.email || currentUser.email || '';
      }
    }

    // Handle login
    function handleLogin() {
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;
      
      if (!email || !password) {
        alert('Please enter both email and password');
        return;
      }
      
      showLoading();
      
      auth.signInWithEmailAndPassword(email, password)
        .then(cred => {
          currentUser = cred.user;
        })
        .catch(err => {
          hideLoading();
          alert(err.message);
        });
    }

    // Handle account creation
    function handleCreateAccount() {
      const email = prompt('Enter your email:');
      if (!email) return;
      
      const password = prompt('Enter your password (min 6 chars):');
      if (!password || password.length < 6) {
        alert('Password must be at least 6 characters');
        return;
      }
      
      const username = prompt('Enter your username:');
      if (!username) {
        alert('Username is required');
        return;
      }
      
      showLoading();
      
      auth.createUserWithEmailAndPassword(email, password)
        .then((cred) => {
          currentUser = cred.user;
          return saveUserToDB(currentUser.uid, {
            uid: currentUser.uid,
            username: username,
            email: email,
            role: 'user',
            blocked: false
          });
        })
        .catch(err => {
          hideLoading();
          alert(err.message);
        });
    }

    // Handle logout
    function handleLogout() {
      showLoading();
      auth.signOut().then(() => {
        currentUser = null;
        currentUserData = null;
        loginPage.style.display = 'flex';
        appContainer.style.display = 'none';
        hideLoading();
      }).catch(error => {
        hideLoading();
        console.error("Logout error:", error);
      });
    }

    // Save user to database
    function saveUserToDB(uid, userData) {
      return db.ref('users/' + uid).update(userData);
    }

    // Start exam
    function startExam() {
      if (!studentNameInput.value || !fatherNameInput.value || !dobInput.value || 
          !symbolNoInput.value || !examSubjectSelect.value || !selectedPhoto) {
        alert('Please fill all fields and upload photo');
        return;
      }
      
      showLoading();
      
      // Upload photo
      const storageRef = storage.ref(`student_photos/${currentUser.uid}_${Date.now()}`);
      storageRef.put(selectedPhoto).then(snapshot => {
        return snapshot.ref.getDownloadURL();
      }).then(photoUrl => {
        currentExam = {
          ...currentExam,
          studentName: studentNameInput.value,
          fatherName: fatherNameInput.value,
          dob: dobInput.value,
          symbolNo: symbolNoInput.value,
          subject: examSubjectSelect.options[examSubjectSelect.selectedIndex].text,
          subjectKey: examSubjectSelect.value,
          photoUrl: photoUrl,
          timestamp: Date.now(),
          userId: currentUser.uid
        };
        
        // Load questions for exam
        loadExamQuestions();
      }).catch(error => {
        hideLoading();
        alert('Failed to upload photo: ' + error.message);
      });
    }

    // Load questions for exam
    function loadExamQuestions() {
      db.ref(`questions/${currentExam.courseKey}/${currentExam.subjectKey}`).once('value').then(snap => {
        const questions = snap.val();
        if (!questions || Object.keys(questions).length === 0) {
          hideLoading();
          alert('No questions available for this subject yet');
          return;
        }
        
        // Convert to array and shuffle
        const questionsArray = Object.values(questions);
        shuffleArray(questionsArray);
        
        // Select first 10 questions (or all if less than 10)
        currentExam.questions = questionsArray.slice(0, Math.min(10, questionsArray.length));
        currentExam.answers = {};
        currentExam.startTime = Date.now();
        
        // Start exam
        startExamTimer();
        displayExamQuestions();
        showPage('exam');
        hideLoading();
      }).catch(error => {
        hideLoading();
        alert('Failed to load questions: ' + error.message);
      });
    }

    // Shuffle array
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Start exam timer
    function startExamTimer() {
      examTimeLeft = 1800; // 30 minutes
      updateTimerDisplay();
      
      if (examTimerInterval) clearInterval(examTimerInterval);
      examTimerInterval = setInterval(() => {
        examTimeLeft--;
        updateTimerDisplay();
        
        if (examTimeLeft <= 0) {
          clearInterval(examTimerInterval);
          submitExam();
        }
      }, 1000);
    }

    // Update timer display
    function updateTimerDisplay() {
      const minutes = Math.floor(examTimeLeft / 60);
      const seconds = examTimeLeft % 60;
      examTimer.textContent = `Time: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
    }

    // Display exam questions
    function displayExamQuestions() {
      examQuestionsContainer.innerHTML = '';
      
      currentExam.questions.forEach((question, index) => {
        const questionDiv = document.createElement('div');
        questionDiv.className = 'question-container';
        questionDiv.innerHTML = `
          <div class="question-text">${index + 1}. ${escapeHtml(question.text)}</div>
          <div class="option" data-question="${index}" data-option="1">${escapeHtml(question.option1)}</div>
          <div class="option" data-question="${index}" data-option="2">${escapeHtml(question.option2)}</div>
          <div class="option" data-question="${index}" data-option="3">${escapeHtml(question.option3)}</div>
          <div class="option" data-question="${index}" data-option="4">${escapeHtml(question.option4)}</div>
        `;
        
        examQuestionsContainer.appendChild(questionDiv);
        
        // Add click handlers for options
        questionDiv.querySelectorAll('.option').forEach(option => {
          option.addEventListener('click', (e) => {
            const questionIndex = parseInt(e.target.dataset.question);
            const optionIndex = parseInt(e.target.dataset.option);
            
            // Deselect all options for this question
            examQuestionsContainer.querySelectorAll(`.option[data-question="${questionIndex}"]`).forEach(opt => {
              opt.classList.remove('selected');
            });
            
            // Select clicked option
            e.target.classList.add('selected');
            
            // Save answer
            currentExam.answers[questionIndex] = optionIndex;
          });
        });
      });
    }

    // Submit exam
    function submitExam() {
      if (examTimerInterval) clearInterval(examTimerInterval);
      
      // Calculate score
      let correctCount = 0;
      currentExam.questions.forEach((question, index) => {
        if (currentExam.answers[index] == question.correctOption) {
          correctCount++;
        }
      });
      
      const percentage = Math.round((correctCount / currentExam.questions.length) * 100);
      let remarks = '';
      
      if (percentage >= 90) remarks = 'A+';
      else if (percentage >= 80) remarks = 'A';
      else if (percentage >= 70) remarks = 'B+';
      else if (percentage >= 60) remarks = 'B';
      else if (percentage >= 50) remarks = 'C+';
      else if (percentage >= 40) remarks = 'C';
      else if (percentage >= 20) remarks = 'D';
      else remarks = 'NG';
      
      currentExam.score = correctCount;
      currentExam.totalQuestions = currentExam.questions.length;
      currentExam.percentage = percentage;
      currentExam.remarks = remarks;
      currentExam.endTime = Date.now();
      
      // Save result
      saveExamResult();
    }

    // Save exam result
    function saveExamResult() {
      showLoading();
      
      db.ref(`results/${currentUser.uid}`).push().set(currentExam)
        .then(() => {
          displayExamResult();
          showPage('examResult');
          hideLoading();
        })
        .catch(error => {
          hideLoading();
          alert('Failed to save result: ' + error.message);
        });
    }

    // Display exam result
    function displayExamResult() {
      resultPhoto.src = currentExam.photoUrl;
      resultName.textContent = currentExam.studentName;
      resultFather.textContent = currentExam.fatherName;
      resultDob.textContent = currentExam.dob;
      resultSymbol.textContent = currentExam.symbolNo;
      resultCourse.textContent = currentExam.course;
      resultSubject.textContent = currentExam.subject;
      totalQuestions.textContent = currentExam.totalQuestions;
      correctAnswers.textContent = currentExam.score;
      examScore.textContent = currentExam.score;
      examPercentage.textContent = currentExam.percentage + '%';
      examRemarks.textContent = currentExam.remarks;
    }

    // Load notices
    function loadNotices() {
      showLoading('notices-container');
      
      db.ref('notices').orderByChild('timestamp').limitToLast(20).once('value').then(snap => {
        const notices = snap.val() || {};
        noticesContainer.innerHTML = '';
        
        Object.entries(notices).reverse().forEach(([id, notice]) => {
          const noticeDiv = document.createElement('div');
          noticeDiv.className = 'notice-item';
          
          let imageHtml = '';
          if (notice.imageUrl) {
            imageHtml = `<img src="${notice.imageUrl}" class="notice-image" alt="Notice image">`;
          }
          
          noticeDiv.innerHTML = `
            <div class="notice-title">${escapeHtml(notice.title)}</div>
            <div class="notice-message">${escapeHtml(notice.message)}</div>
            ${imageHtml}
            <div class="notice-date">${formatDate(notice.timestamp)}</div>
          `;
          
          noticesContainer.appendChild(noticeDiv);
        });
        
        hideLoading('notices-container');
      }).catch(error => {
        hideLoading('notices-container');
        console.error("Error loading notices:", error);
      });
    }

    // Load books
    function loadBooks() {
      showLoading('books-container');
      
      db.ref('books').once('value').then(snap => {
        const books = snap.val() || {};
        booksContainer.innerHTML = '';
        
        Object.entries(books).forEach(([id, book]) => {
          const bookDiv = document.createElement('div');
          bookDiv.className = 'book-item';
          bookDiv.dataset.bookId = id;
          bookDiv.innerHTML = `
            <div class="book-title">${escapeHtml(book.title)}</div>
            <div class="book-desc">${escapeHtml(book.description)}</div>
          `;
          
          bookDiv.addEventListener('click', () => {
            window.open(book.fileUrl, '_blank');
          });
          
          booksContainer.appendChild(bookDiv);
        });
        
        hideLoading('books-container');
      }).catch(error => {
        hideLoading('books-container');
        console.error("Error loading books:", error);
      });
    }

    // Load user results
    function loadUserResults() {
      showLoading('results-list-container');
      
      db.ref(`results/${currentUser.uid}`).orderByChild('timestamp').once('value').then(snap => {
        const results = snap.val() || {};
        resultsListContainer.innerHTML = '';
        
        Object.entries(results).reverse().forEach(([id, result]) => {
          const resultDiv = document.createElement('div');
          resultDiv.className = 'user-item clickable';
          resultDiv.innerHTML = `
            <div class="user-avatar"><i class="fas fa-poll"></i></div>
            <div class="user-info">
              <div class="user-name">${escapeHtml(result.course)} - ${escapeHtml(result.subject)}</div>
              <div class="user-status">Score: ${result.score}/${result.totalQuestions} (${result.percentage}%) - ${result.remarks}</div>
              <div class="last-message">${formatDate(result.timestamp)}</div>
            </div>
          `;
          
          resultDiv.addEventListener('click', () => {
            currentExam = result;
            displayExamResult();
            showPage('examResult');
          });
          
          resultsListContainer.appendChild(resultDiv);
        });
        
        hideLoading('results-list-container');
      }).catch(error => {
        hideLoading('results-list-container');
        console.error("Error loading results:", error);
      });
    }

    // Load admin data
    function loadAdminData() {
      loadQuestions();
      loadAdminNotices();
      loadAdminBooks();
      loadAdminResults();
    }

    // Load questions for admin
    function loadQuestions() {
      showLoading('admin-questions-list');
      
      db.ref(`questions/${currentAdminCourse}/${currentAdminSubject}`).once('value').then(snap => {
        const questions = snap.val() || {};
        adminQuestionsList.innerHTML = '<h3>Questions</h3>';
        
        if (Object.keys(questions).length === 0) {
          adminQuestionsList.innerHTML += '<div style="padding:12px;color:#666;">No questions yet</div>';
          hideLoading('admin-questions-list');
          return;
        }
        
        Object.entries(questions).forEach(([id, question]) => {
          const questionDiv = document.createElement('div');
          questionDiv.className = 'question-list-item';
          questionDiv.innerHTML = `
            <div><strong>${escapeHtml(question.text)}</strong></div>
            <div style="margin-top:5px; font-size:14px;">
              <span style="color:${question.correctOption == 1 ? 'green' : 'inherit'}">1. ${escapeHtml(question.option1)}</span> | 
              <span style="color:${question.correctOption == 2 ? 'green' : 'inherit'}">2. ${escapeHtml(question.option2)}</span> | 
              <span style="color:${question.correctOption == 3 ? 'green' : 'inherit'}">3. ${escapeHtml(question.option3)}</span> | 
              <span style="color:${question.correctOption == 4 ? 'green' : 'inherit'}">4. ${escapeHtml(question.option4)}</span>
            </div>
          `;
          
          questionDiv.addEventListener('click', () => {
            if (confirm('Delete this question?')) {
              db.ref(`questions/${currentAdminCourse}/${currentAdminSubject}/${id}`).remove()
                .then(() => loadQuestions())
                .catch(error => alert('Failed to delete question: ' + error.message));
            }
          });
          
          adminQuestionsList.appendChild(questionDiv);
        });
        
        hideLoading('admin-questions-list');
      }).catch(error => {
        hideLoading('admin-questions-list');
        console.error("Error loading questions:", error);
      });
    }

    // Add question
    function addQuestion() {
      const text = questionTextInput.value.trim();
      const option1 = option1Input.value.trim();
      const option2 = option2Input.value.trim();
      const option3 = option3Input.value.trim();
      const option4 = option4Input.value.trim();
      const correctOption = correctOptionSelect.value;
      
      if (!text || !option1 || !option2 || !option3 || !option4) {
        alert('Please fill all fields');
        return;
      }
      
      showLoading('admin-questions-list');
      
      const question = {
        text: text,
        option1: option1,
        option2: option2,
        option3: option3,
        option4: option4,
        correctOption: parseInt(correctOption),
        timestamp: Date.now()
      };
      
      db.ref(`questions/${currentAdminCourse}/${currentAdminSubject}`).push(question)
        .then(() => {
          questionTextInput.value = '';
          option1Input.value = '';
          option2Input.value = '';
          option3Input.value = '';
          option4Input.value = '';
          loadQuestions();
        })
        .catch(error => {
          hideLoading('admin-questions-list');
          alert('Failed to add question: ' + error.message);
        });
    }

    // Load admin notices
    function loadAdminNotices() {
      showLoading('admin-notices-list');
      
      db.ref('notices').orderByChild('timestamp').limitToLast(20).once('value').then(snap => {
        const notices = snap.val() || {};
        adminNoticesList.innerHTML = '<h3>Existing Notices</h3>';
        
        if (Object.keys(notices).length === 0) {
          adminNoticesList.innerHTML += '<div style="padding:12px;color:#666;">No notices yet</div>';
          hideLoading('admin-notices-list');
          return;
        }
        
        Object.entries(notices).reverse().forEach(([id, notice]) => {
          const noticeDiv = document.createElement('div');
          noticeDiv.className = 'question-list-item';
          
          let imageHtml = '';
          if (notice.imageUrl) {
            imageHtml = `<img src="${notice.imageUrl}" style="max-width:100%; border-radius:4px; margin-top:5px;">`;
          }
          
          noticeDiv.innerHTML = `
            <div><strong>${escapeHtml(notice.title)}</strong></div>
            <div style="margin:5px 0;">${escapeHtml(notice.message)}</div>
            ${imageHtml}
            <div style="text-align:right; font-size:12px; color:#666; margin-top:5px;">
              ${formatDate(notice.timestamp)}
            </div>
          `;
          
          noticeDiv.addEventListener('click', () => {
            if (confirm('Delete this notice?')) {
              db.ref(`notices/${id}`).remove()
                .then(() => loadAdminNotices())
                .catch(error => alert('Failed to delete notice: ' + error.message));
            }
          });
          
          adminNoticesList.appendChild(noticeDiv);
        });
        
        hideLoading('admin-notices-list');
      }).catch(error => {
        hideLoading('admin-notices-list');
        console.error("Error loading notices:", error);
      });
    }

    // Add notice
    function addNotice() {
      const title = noticeTitleInput.value.trim();
      const message = noticeMessageInput.value.trim();
      
      if (!title || !message) {
        alert('Please fill title and message');
        return;
      }
      
      showLoading('admin-notices-list');
      
      if (selectedNoticePhoto) {
        // Upload image
        const storageRef = storage.ref(`notice_images/${Date.now()}`);
        storageRef.put(selectedNoticePhoto).then(snapshot => {
          return snapshot.ref.getDownloadURL();
        }).then(imageUrl => {
          return saveNotice(title, message, imageUrl);
        }).catch(error => {
          hideLoading('admin-notices-list');
          alert('Failed to upload image: ' + error.message);
        });
      } else {
        saveNotice(title, message);
      }
    }

    // Save notice to database
    function saveNotice(title, message, imageUrl = null) {
      const notice = {
        title: title,
        message: message,
        timestamp: Date.now()
      };
      
      if (imageUrl) {
        notice.imageUrl = imageUrl;
      }
      
      db.ref('notices').push(notice)
        .then(() => {
          noticeTitleInput.value = '';
          noticeMessageInput.value = '';
          noticePhotoPreview.innerHTML = '<i class="fas fa-image" style="color:#ccc;"></i>';
          selectedNoticePhoto = null;
          loadAdminNotices();
        })
        .catch(error => {
          hideLoading('admin-notices-list');
          alert('Failed to add notice: ' + error.message);
        });
    }

    // Load admin books
    function loadAdminBooks() {
      showLoading('admin-books-list');
      
      db.ref('books').once('value').then(snap => {
        const books = snap.val() || {};
        adminBooksList.innerHTML = '<h3>Existing Books</h3>';
        
        if (Object.keys(books).length === 0) {
          adminBooksList.innerHTML += '<div style="padding:12px;color:#666;">No books yet</div>';
          hideLoading('admin-books-list');
          return;
        }
        
        Object.entries(books).forEach(([id, book]) => {
          const bookDiv = document.createElement('div');
          bookDiv.className = 'question-list-item';
          bookDiv.innerHTML = `
            <div><strong>${escapeHtml(book.title)}</strong> (${book.course})</div>
            <div style="margin:5px 0;">${escapeHtml(book.description)}</div>
            <div style="text-align:right; font-size:12px; color:#666;">
              <a href="${book.fileUrl}" target="_blank">View PDF</a>
            </div>
          `;
          
          bookDiv.addEventListener('click', () => {
            if (confirm('Delete this book?')) {
              db.ref(`books/${id}`).remove()
                .then(() => loadAdminBooks())
                .catch(error => alert('Failed to delete book: ' + error.message));
            }
          });
          
          adminBooksList.appendChild(bookDiv);
        });
        
        hideLoading('admin-books-list');
      }).catch(error => {
        hideLoading('admin-books-list');
        console.error("Error loading books:", error);
      });
    }

    // Add book
    function addBook() {
      const title = bookTitleInput.value.trim();
      const description = bookDescInput.value.trim();
      const course = bookCourseSelect.value;
      
      if (!title || !description || !selectedBookFile) {
        alert('Please fill all fields and select PDF file');
        return;
      }
      
      showLoading('admin-books-list');
      
      // Upload PDF
      const storageRef = storage.ref(`books/${Date.now()}_${selectedBookFile.name}`);
      storageRef.put(selectedBookFile).then(snapshot => {
        return snapshot.ref.getDownloadURL();
      }).then(fileUrl => {
        const book = {
          title: title,
          description: description,
          course: course,
          fileUrl: fileUrl,
          timestamp: Date.now()
        };
        
        return db.ref('books').push(book);
      }).then(() => {
        bookTitleInput.value = '';
        bookDescInput.value = '';
        bookFileUpload.value = '';
        selectedBookFile = null;
        loadAdminBooks();
      }).catch(error => {
        hideLoading('admin-books-list');
        alert('Failed to upload book: ' + error.message);
      });
    }

    // Load admin results
    function loadAdminResults() {
      showLoading('admin-results-list');
      
      db.ref('results').orderByChild('timestamp').limitToLast(50).once('value').then(snap => {
        const results = snap.val() || {};
        adminResultsList.innerHTML = '<h3>Student Results</h3>';
        
        if (Object.keys(results).length === 0) {
          adminResultsList.innerHTML += '<div style="padding:12px;color:#666;">No results yet</div>';
          hideLoading('admin-results-list');
          return;
        }
        
        // Group by user
        const userResults = {};
        
        Object.entries(results).forEach(([id, result]) => {
          if (!userResults[result.userId]) {
            userResults[result.userId] = {
              name: result.studentName,
              results: []
            };
          }
          userResults[result.userId].results.push(result);
        });
        
        // Display results
        Object.entries(userResults).forEach(([userId, userData]) => {
          const userDiv = document.createElement('div');
          userDiv.className = 'question-list-item';
          userDiv.innerHTML = `
            <div><strong>${escapeHtml(userData.name)}</strong></div>
            <div style="margin-top:5px;">
              ${userData.results.map(result => `
                <div style="margin-bottom:5px; font-size:14px;">
                  ${result.course} - ${result.subject}: ${result.score}/${result.totalQuestions} (${result.percentage}%) - ${result.remarks}
                  <span style="color:#666; font-size:12px;">${formatDate(result.timestamp)}</span>
                </div>
              `).join('')}
            </div>
          `;
          
          adminResultsList.appendChild(userDiv);
        });
        
        hideLoading('admin-results-list');
      }).catch(error => {
        hideLoading('admin-results-list');
        console.error("Error loading results:", error);
      });
    }

    // Format date
    function formatDate(timestamp) {
      const date = new Date(timestamp);
      return date.toLocaleString();
    }

    // Show loading indicator
    function showLoading(containerId) {
      const container = containerId ? document.getElementById(containerId) : document.body;
      const spinner = document.createElement('div');
      spinner.className = 'spinner';
      spinner.id = 'loading-spinner';
      
      if (containerId) {
        container.innerHTML = '';
        container.appendChild(spinner);
      } else {
        if (!document.getElementById('loading-spinner')) {
          document.body.appendChild(spinner);
        }
      }
    }

    // Hide loading indicator
    function hideLoading(containerId) {
      if (containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        const spinner = container.querySelector('#loading-spinner');
        if (spinner) spinner.remove();
      } else {
        const spinner = document.getElementById('loading-spinner');
        if (spinner) spinner.remove();
      }
    }

    // Utility: escape HTML
    function escapeHtml(unsafe) {
      if (unsafe === null || unsafe === undefined) return '';
      return String(unsafe)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // Initialize the app
    init();
  </script>
</body>
</html>
